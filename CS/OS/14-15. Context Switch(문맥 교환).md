### 14-15. **Context Switch(문맥 교환)**

`문맥 교환`이란 CPU를 어떤 프로세스에서 다른 프로세스로 넘겨주는 과정을 말한다.       
= CPU에 실행할 프로세스를 교체하는 기술

- 전환하는 동안 어떠한 작업도 불가능.

<br>

> ### 문맥교환이 일어나는 상황

- 인터럽트 中 
  - timer interrupt
  - I/O 요청 System Call
- 따라서 System Call이나 Interrupt 발생 ⇒ Context Switch 보장 X 
  이유? 다른 프로세스로 넘어가는 과정은 상당한 오버헤드를 발생시킴. cache memory에 있던 진행하던 프로세스에 대한 캐시를 모두 비워줘야 하기 때문.

<br>

> ### 문맥교환 일어나는 과정 
> = 컨텍스트 스위칭 코드 실행 과정(순서)

가정: 실행중인 `프로세스 A`, 변경될 `프로세스 B`

1. 현재 CPU에 수행되고 있는 `프로세스 A`의 레지스터 정보(`PC`, `SP` 등의 주소값)를 해당 프로세스 A의 `PCB`에 업데이트한다. + 메인 메모리에 저장. 주의 : 현재 실행중인 작업 부분은 완료하고 넘어가야 함. (1~5 단계중 2단계 진행중이면 2단계 마무리 하고 `프로세스 B`로 넘어가야 함)
2. `프로세스 B`의 PCB의 정보(레지스터 정보)를 메인메모리에서 로드.
3. CPU 레지스터에 `프로세스 B`의 레지스터 정보를 업데이트하고 **실행**한다. 👉 실행 = dispatch. 프로세스 상태를 ready 상태에서 running 상태로 변경.

📌 리눅스 : Context Switching 코드는 각 CPU 마다 별도로 존재함.

<br>

> ### 레지스터 정보?

PC(프로그램 카운터), SP(스택 포인터) 등을 포함한다.

- PC : 다음 실행할 명령어의 주소값
- SP : 현재 실행 중인 스택 위치

<br>

> ### PCB 란?

프로세스가 실해중인 상태를 캡쳐 혹은 구조화해서 저장함.

- Process Control Block. = Process Context Block

- PCB 구조/ 저장하는 것들

  - Process ID ( `PID` )
  - 레지스터 정보 (= Register 값 PC, SP 등)
  - 프로세스 상태 (스케쥴링 정보)
  - 메모리  정보 (메모리 사이즈 limit)

  ![리눅스 PCB](/images/CS/OS/14_pcb.jpeg)

  

